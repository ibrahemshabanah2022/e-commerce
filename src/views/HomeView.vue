<template>
  <!-- Carousel Start -->
  <div class="container-fluid mb-3">
    <div class="row px-xl-5">
      <!-- <div class="col-lg-8">
        <div
          id="header-carousel"
          class="carousel slide carousel-fade mb-30 mb-lg-0"
          data-ride="carousel"
        >
          <ol class="carousel-indicators">
            <li
              data-target="#header-carousel"
              data-slide-to="0"
              class="active"
            ></li>
            <li data-target="#header-carousel" data-slide-to="1"></li>
            <li data-target="#header-carousel" data-slide-to="2"></li>
          </ol>
          <div class="carousel-inner">
            <div
              class="carousel-item position-relative active"
              style="height: 430px"
            >
              <img
                class="position-absolute w-100 h-100"
                src="img/carousel-1.jpg"
                style="object-fit: cover"
              />
              <div
                class="carousel-caption d-flex flex-column align-items-center justify-content-center"
              >
                <div class="p-3" style="max-width: 700px">
                  <h1
                    class="display-4 text-white mb-3 animate__animated animate__fadeInDown"
                  >
                    Men Fashion
                  </h1>
                  <p class="mx-md-5 px-5 animate__animated animate__bounceIn">
                    Lorem rebum magna amet lorem magna erat diam stet. Sadips
                    duo stet amet amet ndiam elitr ipsum diam
                  </p>
                  <a
                    class="btn btn-outline-light py-2 px-4 mt-3 animate__animated animate__fadeInUp"
                    href="#"
                    >Shop Now</a
                  >
                </div>
              </div>
            </div>
            <div class="carousel-item position-relative" style="height: 430px">
              <img
                class="position-absolute w-100 h-100"
                src="img/carousel-2.jpg"
                style="object-fit: cover"
              />
              <div
                class="carousel-caption d-flex flex-column align-items-center justify-content-center"
              >
                <div class="p-3" style="max-width: 700px">
                  <h1
                    class="display-4 text-white mb-3 animate__animated animate__fadeInDown"
                  >
                    Women Fashion
                  </h1>
                  <p class="mx-md-5 px-5 animate__animated animate__bounceIn">
                    Lorem rebum magna amet lorem magna erat diam stet. Sadips
                    duo stet amet amet ndiam elitr ipsum diam
                  </p>
                  <a
                    class="btn btn-outline-light py-2 px-4 mt-3 animate__animated animate__fadeInUp"
                    href="#"
                    >Shop Now</a
                  >
                </div>
              </div>
            </div>
            <div class="carousel-item position-relative" style="height: 430px">
              <img
                class="position-absolute w-100 h-100"
                src="img/carousel-3.jpg"
                style="object-fit: cover"
              />
              <div
                class="carousel-caption d-flex flex-column align-items-center justify-content-center"
              >
                <div class="p-3" style="max-width: 700px">
                  <h1
                    class="display-4 text-white mb-3 animate__animated animate__fadeInDown"
                  >
                    Kids Fashion
                  </h1>
                  <p class="mx-md-5 px-5 animate__animated animate__bounceIn">
                    Lorem rebum magna amet lorem magna erat diam stet. Sadips
                    duo stet amet amet ndiam elitr ipsum diam
                  </p>
                  <a
                    class="btn btn-outline-light py-2 px-4 mt-3 animate__animated animate__fadeInUp"
                    href="#"
                    >Shop Now</a
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div> -->
      <!-- <div class="col-lg-4">
        <div class="product-offer mb-30" style="height: 200px">
          <img class="img-fluid" src="img/offer-1.jpg" alt="" />
          <div class="offer-text">
            <h6 class="text-white text-uppercase">Save 20%</h6>
            <h3 class="text-white mb-3">Special Offer</h3>
            <a href="" class="btn btn-primary">Shop Now</a>
          </div>
        </div>
        <div class="product-offer mb-30" style="height: 200px">
          <img class="img-fluid" src="img/offer-2.jpg" alt="" />
          <div class="offer-text">
            <h6 class="text-white text-uppercase">Save 20%</h6>
            <h3 class="text-white mb-3">Special Offer</h3>
            <a href="" class="btn btn-primary">Shop Now</a>
          </div>
        </div>
      </div> -->
    </div>
  </div>
  <!-- Carousel End -->
  <!-- Featured Start -->
  <!-- <div class="container-fluid pt-5">
    <div class="row px-xl-5 pb-3">
      <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
        <div
          class="d-flex align-items-center bg-light mb-4"
          style="padding: 30px"
        >
          <h1 class="fa fa-check text-primary m-0 mr-3"></h1>
          <h5 class="font-weight-semi-bold m-0">Quality Product</h5>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
        <div
          class="d-flex align-items-center bg-light mb-4"
          style="padding: 30px"
        >
          <h1 class="fa fa-shipping-fast text-primary m-0 mr-2"></h1>
          <h5 class="font-weight-semi-bold m-0">Free Shipping</h5>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
        <div
          class="d-flex align-items-center bg-light mb-4"
          style="padding: 30px"
        >
          <h1 class="fas fa-exchange-alt text-primary m-0 mr-3"></h1>
          <h5 class="font-weight-semi-bold m-0">14-Day Return</h5>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
        <div
          class="d-flex align-items-center bg-light mb-4"
          style="padding: 30px"
        >
          <h1 class="fa fa-phone-volume text-primary m-0 mr-3"></h1>
          <h5 class="font-weight-semi-bold m-0">24/7 Support</h5>
        </div>
      </div>
    </div>
  </div> -->
  <!-- Featured End -->

  <!-- Products Start -->
  <!-- <div>
    <div v-if="loading">Loading...</div>
    <div v-else>
      <div v-for="product in products" :key="product.id">
        <div class="card">
          <div class="card-header">{{ product.title }}</div>
          <div class="card-body">
            <p>{{ product.description }}</p>
            <p>Price: {{ product.price }}</p>
          </div>
        </div>
      </div>
    </div>
  </div> -->

  <div class="container-fluid pt-5 pb-3">
    <h2 class="section-title position-relative text-uppercase mx-xl-5 mb-4">
      <span class="bg-secondary pr-3">Featured Products</span>
    </h2>
    <div>
      <div class="row">
        <div class="col-md-3">
          <div class="mb-4">
            <h4
              class="text-uppercase mx-xl-5 mb-4 d-flex justify-content-center pt-3"
            >
              <span class="pr-3">categories</span>
            </h4>
            <ul class="list-group list-group-flush">
              <li
                class="list-group-item"
                v-for="category in categories"
                :key="category.id"
                @click="filterProducts(category.id)"
              >
                {{ category.name }}
              </li>
            </ul>
          </div>
        </div>
        <div class="col-md-9">
          <div class="mb-4">
            <div class="card-body">
              <div class="input-group mb-3">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Search for products"
                  v-model="searchTerm"
                />
                <div class="input-group-append">
                  <button
                    class="btn btn-outline-secondary bg-warning text-dark"
                    type="button"
                    @click="searchProducts()"
                  >
                    Search
                  </button>
                </div>
              </div>
              <div class="row">
                <div
                  class="col-md-4 mb-4"
                  v-for="product in products"
                  :key="product.id"
                >
                  <div class="product-item bg-light mb-4">
                    <div
                      class="product-img position-relative overflow-hidden aspect-ratio aspect-ratio-1x1"
                    >
                      <img class="card-img-top" :src="product.images" alt="" />
                      <div class="product-action">
                        <a
                          v-on:click="showSwal(product)"
                          class="btn btn-outline-dark btn-square"
                          @click="saveProduct(product)"
                          ><i class="fa fa-shopping-cart"></i
                        ></a>
                        <a class="btn btn-outline-dark btn-square" href=""
                          ><i class="far fa-heart"></i
                        ></a>
                        <a
                          class="btn btn-outline-dark btn-square"
                          @click="viewProduct(product.id)"
                          ><i class="fa fa-eye"></i
                        ></a>
                      </div>
                      <div class="card-body">
                        <h5 class="card-title">{{ product.title }}</h5>
                        <!-- <p class="card-text">{{ product.description }}</p> -->
                        <h6 class="card-subtitle mb-2 text-muted">
                          {{ product.price }}$
                        </h6>
                        <!-- <button @click="viewProduct(product.id)">
                          View Details
                        </button> -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Products End -->

  <!-- Offer Start -->
  <div class="container-fluid pt-5 pb-3">
    <div class="row px-xl-5">
      <div class="col-md-6">
        <div class="product-offer mb-30" style="height: 300px">
          <img class="img-fluid" src="img/offer-1.jpg" alt="" />

          <div class="offer-text">
            <h6 class="text-white text-uppercase">Save 20%</h6>
            <h3 class="text-white mb-3">Special Offer</h3>
            <a href="" class="btn btn-primary">Shop Now</a>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="product-offer mb-30" style="height: 300px">
          <img class="img-fluid" src="img/offer-2.jpg" alt="" />
          <div class="offer-text">
            <h6 class="text-white text-uppercase">Save 20%</h6>
            <h3 class="text-white mb-3">Special Offer</h3>
            <a href="" class="btn btn-primary">Shop Now</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Offer End -->
</template>
<script>
import { ref, onMounted } from "vue";

export default {
  setup() {
    const products = ref([]);
    const categories = ref([]);
    const searchTerm = ref("");

    const fetchProducts = async () => {
      const response = await fetch(
        "http://localhost:8000/api/products?offset=0&limit=12"
      );
      const data = await response.json();
      products.value = data;
    };

    const fetchCategories = async () => {
      const response = await fetch(
        "https://api.escuelajs.co/api/v1/categories"
      );
      const data = await response.json();
      categories.value = data;
    };

    const filterProducts = async (categoryId) => {
      const response = await fetch(
        `https://api.escuelajs.co/api/v1/categories/${categoryId}/products?offset=0&limit=12`
      );
      const data = await response.json();
      products.value = data;
    };

    const searchProducts = async () => {
      const response = await fetch(
        `https://api.escuelajs.co/api/v1/products?title=${searchTerm.value}`
      );
      const data = await response.json();
      products.value = data;
    };

    const viewProduct = (productId) => {
      // Do something to view the product
    };

    onMounted(() => {
      fetchProducts();
      fetchCategories();
    });

    return {
      products,
      categories,
      searchTerm,
      filterProducts,
      searchProducts,
      // viewProduct,
    };
  },

  methods: {
    showSwal(product) {
      let productt = JSON.parse(localStorage.getItem("product")) || [];
      const tIndex = productt.findIndex((p) => p.id === product.id);
      if (tIndex === -1) {
        this.$store.commit("updateCartCount", 1);
      } else {
        this.$store.commit("updateCartCount", 0);
      }
    },

    saveProduct(product) {
      // Get existing products from local storage or create an empty array
      let products = JSON.parse(localStorage.getItem("product")) || [];

      // Check if the product is already in the cart
      const productIndex = products.findIndex((p) => p.id === product.id);

      if (productIndex === -1) {
        // If the product is not in the cart, add it to the array
        products.push(product);

        // Save the updated array to local storage
        localStorage.setItem("product", JSON.stringify(products));
      } else {
        // If the product is already in the cart, do nothing
        alert("Product already in cart");
      }
    },
    // saveProduct(product) {
    //   // Get existing products from local storage or create an empty array
    //   let products = JSON.parse(localStorage.getItem("product")) || [];

    //   // Add the new product to the array
    //   products.push(product);

    //   // Save the updated array to local storage
    //   localStorage.setItem("product", JSON.stringify(products));
    // },
    viewProduct(id) {
      this.$router.push(`/products/${id}`);
    },
  },
};
// export default {
//   data() {
//     return {
//       products: [],
//       loading: true,
//     };
//   },
//   async created() {
//     const response = await fetch(
//       "https://api.escuelajs.co/api/v1/products?offset=0&limit=10"
//     );
//     const data = await response.json();
//     this.products = data;
//     this.loading = false;
//   },
// };
</script>
<style>
.product-img img {
  height: 200px;
  width: 300px;
}
.product-item {
  height: 300px;
}
</style>
